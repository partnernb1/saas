<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Today's Amazon Deals üè∑Ô∏è</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .noscroll {
      overflow: hidden;
      height: 100vh;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">

<header class="bg-red-600 text-white py-4 shadow-md">
  <div class="max-w-6xl mx-auto flex items-center justify-between px-4">
    <h2 class="text-2xl font-bold flex items-center space-x-2">
      <span>Today's Deals</span>
      <span class="text-yellow-300 text-xl">üè∑Ô∏è</span>
    </h2>
    <div class="flex items-center space-x-4">
      <button id="searchBtn" class="p-2 rounded hover:bg-red-500 transition" aria-label="Search">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16z" />
        </svg>
      </button>
    </div>
  </div>
</header>

<main class="max-w-7xl mx-auto p-4">
  <h1 class="text-3xl font-bold text-center mb-6">
    <span class="border-b-4 border-yellow-400 inline-block pb-1">Top Amazon Deals</span>
  </h1>  

  <div id="productsGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
    <!-- –ü—Ä–æ–¥—É–∫—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç—É—Ç -->
  </div>
</main>

<footer class="mt-12 p-4 text-center text-gray-500 text-sm">
  ¬© 2025 Amazon Top Deals. Not affiliated with Amazon.
</footer>

<!-- –ü–æ–∏—Å–∫ -->
<div id="searchPopup" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
  <div class="bg-white p-6 rounded-xl shadow max-w-sm w-full">
    <h3 class="text-lg font-bold mb-4 text-gray-800">Search Deals</h3>
    <input id="searchInput" type="text" placeholder="Type your search..." class="w-full border rounded p-2 mb-4">
    <div class="flex justify-end space-x-2">
      <button id="closeSearch" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
      <button id="submitSearch" class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">Search</button>
    </div>
  </div>
</div>

<script>
let products = [];

window.addEventListener("load", () => {
  fetch('./products.json')
    .then(res => res.json())
    .then(data => {
      products = data;
      renderProducts(products);
    });
});

function renderProducts(productsToRender) {
  const grid = document.getElementById('productsGrid');
  grid.innerHTML = '';

  productsToRender.forEach(product => {
    const card = document.createElement('a');
    card.href = product.url;
    card.target = "_blank";
    card.className = "bg-white rounded-2xl shadow hover:shadow-xl overflow-hidden relative group flex flex-col transition transform hover:scale-[1.01]";


    // –î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–µ–∫–∏–Ω–≥ –∫–ª–∏–∫–æ–≤
    card.addEventListener('click', () => {
      const data = {
        url: window.location.href,
        asin: product.asin || product.id || ''
      };

      fetch('https://script.google.com/macros/s/AKfycbyIeqj2WSxZejfdYPfZpRWgp4HMP358FRrqRHOmUQOe_LRMxILNjXyaM2PUfzq3CEwD/exec', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      }).catch(err => {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets', err);
      });
    });


    
    const imageWrapper = document.createElement('div');
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–≤–∞–¥—Ä–∞—Ç —Å padding-bottom
    imageWrapper.style.position = "relative";
    imageWrapper.style.width = "100%";
    imageWrapper.style.paddingBottom = "100%"; // –∫–≤–∞–¥—Ä–∞—Ç
    imageWrapper.style.backgroundColor = "#fff"; // –±–µ–ª—ã–π —Ñ–æ–Ω
    imageWrapper.style.borderBottom = "1px solid #e5e7eb"; // tailwind border-gray-200
    imageWrapper.style.display = "flex";
    imageWrapper.style.alignItems = "center";
    imageWrapper.style.justifyContent = "center";

    const img = new Image();
    img.src = `https://images.weserv.nl/?url=${encodeURIComponent(product.imageUrl)}&w=400`;
    img.alt = "Product";
    // –ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–≤–∞–¥—Ä–∞—Ç–∞
    img.style.position = "absolute";
    img.style.top = "0";
    img.style.left = "0";
    img.style.width = "100%";
    img.style.height = "100%";
    img.style.objectFit = "contain";

    imageWrapper.appendChild(img);

    const content = document.createElement('div');
    content.className = "p-4 flex flex-col flex-grow bg-gray-50";

    content.innerHTML = `
      <h2 class="text-sm font-semibold line-clamp-2 text-gray-800 mb-2">${product.title}</h2>
      <div class="flex items-center justify-between">
        <div class="text-yellow-500 text-sm">‚≠ê ${product.rating}</div>
        <div class="text-base bg-red-500 text-white px-2 py-0.5 rounded font-semibold">-${product.discount}%</div>
      </div>
    `;

    card.appendChild(imageWrapper);
    card.appendChild(content);   
    grid.appendChild(card);
  });
}



// –ü–æ–∏—Å–∫ (–æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram)
document.getElementById('searchBtn').addEventListener('click', () => {
  document.getElementById('searchPopup').classList.remove('hidden');
});

document.getElementById('closeSearch').addEventListener('click', () => {
  document.getElementById('searchPopup').classList.add('hidden');
});

document.getElementById('submitSearch').addEventListener('click', () => {
  const query = document.getElementById('searchInput').value.trim();
  if (query) {
    sendToTelegram(`üîé User search: ${query}`);
    document.getElementById('searchPopup').classList.add('hidden');
    document.getElementById('searchInput').value = '';
  }
});

function sendToTelegram(message) {
  const token = '7631704262:AAEFwpc9cb_JLEnln0n1HcqAxoQOx-SZDag';
  const chatId = '1089471130';

  fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      chat_id: chatId,
      text: message
    })
  });
}
</script>
<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "s4jybu6ya6");
</script>	
</body>
</html>
